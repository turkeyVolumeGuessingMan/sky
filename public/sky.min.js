function p(e){document.getElementById("btns").innerHTML="",e=(e=e.trim()).toLowerCase();var n,t=u.node.split("/");t&&(t.pop(),t.push(e),n=s(t.join("/")),u[n]?o(t.join("/")):o(e))}var e={3027034:"I'm blue da ba dee.\r\n\r\n#!spring wine\r\n\r\n>> Go North @northWalk",1395482112:"Oh really? says the Owl.\r\n\r\n>> Yes really @blue",1783010773:"Default response text",2018526348:"You read a book.\r\n\r\n#spring wine\r\n\r\nIt appears to be about (clams|hats|paper|toast).\r\n\r\n\r\n\r\n>> Read blue @blue\r\n\r\n>> Read me @start\r\n\r\n>> Go North @northWalk","-313424166":"You walk north.\r\n\r\nThen east. ? (spring wine) => { You have the spring wine. } Then you go west.\r\n\r\n\r\n>> @stormBegins\r\n\r\n>> Read book @start/readBook","-1120101400":"You walk north in the storm.\r\n\r\n? (spring wine) => {\r\n    You have the spring wine.\r\n}\r\n\r\n> Read book @start/readBook","-474174766":'"The storm begins," I said.\r\n\r\n$northWalk/storm\r\n\r\n>> Read a book @start',"-1617690810":"Hello world *again*\r\n\r\n{{quick}}\r\n\r\n> Go North @northWalk\r\n\r\n>> Read Book @readBook\r\n\r\n_ Type verb here\r\nblag @quick\r\nfoo|bar @readBook\r\n* @defaultResponse"};const a=e=>{const o=e=>{n=(e=e).indexOf('"',2)-1;var n,e=e.substr(1,n);return e=(n=e).length-1,`“${","===n[e]?n.substr(0,e)+".":n}”`},i=(t,r)=>{if(""!==(t=t.trim()))return t;{let e=u.node.split("/");r===e.pop()&&(r="main"),e=e.join("/");t=-1===r.indexOf("/")?e+"/"+r:r;let[,n]=f(t);return n=-1<(n=n.trim().split("\n")[0]).indexOf('"')?o(n):n}},a=e=>{var n=document.createElement("button");const[t,r]=e.slice(1).split("@"),o=u.node+"-"+s(t);return u[o]?null:(n.textContent=i(t,r),n.onclick=()=>{return e=o,n=r,u[e]=!0,void p(n);var e,n},n)},l=e=>{var e=e.split(" ---- "),n=e.pop().trim().split("///").filter(e=>e),e=e.pop()??"Type input here:";{e=e.substr(1).trim();var l=n;const t=document.createElement("form"),s=document.createElement("input"),r=document.createElement("input"),o=document.createElement("div"),i=(t.className="inputForm",t.action="javascript:void(0)",t.onsubmit=e=>{e.preventDefault(),i()},o.className="inputLabel",o.innerHTML=m(e),s.type="text",s.action="javascript:void(0)",s.enterkeyhint="go",s.className="inputString",r.action="javascript:void(0)",r.type="submit",r.className="submit",r.hidden=!0,r.onclick=e=>{e.preventDefault(),i()},t.appendChild(o),t.appendChild(s),t.appendChild(r),()=>{const e=s.value.trim();var n,t=l.filter(e=>0===e.indexOf("*"))[0],r=l.filter(e=>0!==e.indexOf("*")).map(e=>e.split("@"));if(""!==e.trim()){for(var[o,i]of r)for(const a of o.split("|"))if(n=a.trim(),-1<e.indexOf(n))return console.log(a),void p(i);t&&(r=t.split("@").pop())&&p(r)}});return t}};e=(e=(e=>{var n=e.split("\n");let t=-1;for(let e=0;e<n.length;e+=1){var r=n[e],o=n[e]??"";-1<r.indexOf("_")&&-1===t?n[t=e]+=" ---- ":"\n"===r&&"\n"===o?t=-1:-1<t&&(n[t]+=n[e]+"///",n[e]="")}return n.join("\n")})(e)).split("\n");return[e.map(e=>{if(0!==e.indexOf(">>"))return 0===e.indexOf(">")?a(e):0===e.indexOf("_")?l(e):null;{var n=document.createElement("button");const[t,r]=e.slice(2).split("@");return n.textContent=i(t,r),n.onclick=()=>p(r),n}}).filter(e=>e),e.filter(e=>0!==e.indexOf(">")&&0!==e.indexOf("_")).join("\n")]};function s(e){var n=0;if(0!=e.length)for(i=0;i<e.length;i++)n=(n<<5)-n+(char=e.charCodeAt(i)),n&=n;return n}const d=i=>{return[...i.matchAll(/\(.*\)/gm)].map(e=>{var n,t,r,o,[e]=e;-1<e.indexOf("|")&&(n=e.slice(1,-1).split("|"),t=s(u.node+"-"+n[0]),o=n[r=u[t]??0],0===r?u[t]=1:r<n.length-1&&(u[t]+=1),i=i.replace(e,o))}),i};window.addEventListener("load",()=>{u={...e},o("start")});const c=t=>{return[...t.matchAll(/\{\{(.*)\}\}/gm)].map(e=>{var[e,n]=e,n=(e=>{e=(e=e.trim()).toLowerCase();var n,t=u.node.split("/");if(t)return t.pop(),t.push(e),n=s(t.join("/")),u[n]?([n,t]=f(t.join("/")),r(n),t):([n,t]=f(e),r(n),t)})(n);t=t.replace(e,n)}),t};let u={};const m=(e,n=!1)=>{let t=0;const r=n?"div":"p";return e.split("\n").map(e=>e.trim()).join("\n").split("\n\n").filter(e=>""!==e).map(e=>`<${r}>${(r=>{const o={quote:!0,bold:!0,italic:!0};var e=(e,n,t)=>{for(;-1<r.indexOf(e);)r=o[n]?r.replace(e,`<${t}>`):r.replace(e,`</${t}>`),o[n]=!o[n]},n=(n,t)=>r=r.split("\n").map(e=>0===e.trimStart().indexOf(n)?`<${t}>${e.replace(n,"")}</${t}>`:e).join("\n");for(n("#### ","h4"),n("### ","h3"),n("## ","h2"),n("# ","h1");-1<r.indexOf("[[");)r=t%2==0?r.replace("[[","&ldquo;"):r.replace("[[","&lsquo;"),t+=1;for(;-1<r.indexOf("]]");)--t,r=t%2==0?r.replace("]]","&rdquo;"):r.replace("]]","&rsquo;");for(e("``","quote","q"),e('"',"quote","q"),e("**","bold","b"),e("*","italic","i");-1<r.indexOf("'");)r=r.replace("'","&rsquo;");return r=r.trim()})(e)}</${r}>`).join("")};function r(e){const n=document.getElementById("btns");e.map(e=>n.appendChild(e))}function f(e){var n=s((e=e.toLowerCase())+"/"+(u[e+"-state"]??"main"));let t="";t=u[n]||(n=s(e),u[n]),t=l(t);var[e,n]=a(t);return[e,n]}function o(e){e=e.toLowerCase();var n=u[e+"-state"]??"main",t=s(e+"/"+n);let r="";u.base=e,r=u[t]?(u.node=e+"/"+n,u[t]):(n=s(e),u.node=e,u[n]),r=l(r);var[t,e]=a(r);{n=t,t=e;const o=document.getElementById("btns");document.getElementById("page").innerHTML=m(t),n.map(e=>o.appendChild(e))}}const l=n=>{const t=/\?\s*\((.*)\)\s*=>\s\{([^<>]*)\}/gm,r=e=>{var n;return-1<(e=e.trim()).indexOf("!")?(n=s(e=e.replace("!")),!u[n]):(n=s(e),u[n])};{let e=[...n.matchAll(t)];for(;0<e.length;){var o=e[0],[i,a,l]=o,o=o.index;n=n.replace(i,""),i=a,r(i)&&(n=n.slice(0,o)+l+n.slice(o,n.length)),e=[...n.matchAll(t)]}n=c(n),n=(n=d(n)).split(/\r?\n/).map(t=>{if("#"===t[0]){let e=!0,n=t.trim();-1<(n=n.replace("#","")).indexOf("!")&&(e=!1,n=n.replace("!",""));var r=s(n);return u[r]=e,""}if("$"!==t[0])return t;{let e=t.trim();r=(e=(e=e.replace("$","")).split("/")).pop(),t=(e.join("/")+"-state").toLowerCase();return u[t]=r,""}}).join("\n").trim()}return n};