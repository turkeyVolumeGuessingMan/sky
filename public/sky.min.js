var e={3027034:"I'm blue da ba dee.\r\n\r\n#!spring wine\r\n\r\n>> Go North @northWalk",1395482112:"Oh really? says the Owl.\r\n\r\n>> Yes really @blue",2018526348:"You read a book.\r\n\r\n#spring wine\r\n\r\n(clam|hat|paper|toast)\r\n\r\n\r\n>> Read blue @blue\r\n\r\n>> Read me @start\r\n\r\n>> Go North @northWalk","-313424166":"You walk north.\r\n\r\nThen east. ? (spring wine) => { You have the spring wine. } Then you go west.\r\n\r\n>> @stormBegins\r\n\r\n>> Read book @start/readBook","-1120101400":"You walk north in the storm.\r\n\r\n? (spring wine) => {\r\n    You have the spring wine.\r\n}\r\n\r\n> Read book @start/readBook","-474174766":'"The storm begins," I said.\r\n\r\n$northWalk/storm\r\n\r\n>> Read a book @start',"-1617690810":"Hello world *again*\r\n\r\n{{quick}}\r\n\r\n> Go North @northWalk\r\n\r\n>> Read Book @readBook"};const a=e=>{const a=e=>{document.getElementById("btns").innerHTML="",e=(e=e.trim()).toLowerCase();var n,r=c.node.split("/");r&&(r.pop(),r.push(e),n=s(r.join("/")),c[n]?m(r.join("/")):m(e))},o=e=>{n=(e=e).indexOf('"',2)-1;var n,e=e.substr(1,n);return e=(n=e).length-1,`“${","===n[e]?n.substr(0,e)+".":n}”`},i=(r,t)=>{if(""!==(r=r.trim()))return r;{let e=c.node.split("/");t===e.pop()&&(t="main"),e=e.join("/");r=-1===t.indexOf("/")?e+"/"+t:t;let[,n]=u(r);return n=-1<(n=n.trim().split("\n")[0]).indexOf('"')?o(n):n}},l=e=>{var n=document.createElement("button");const[r,t]=e.slice(1).split("@"),o=c.node+"-"+s(r);return c[o]?null:(n.textContent=i(r,t),n.onclick=()=>{return e=o,n=t,c[e]=!0,void a(n);var e,n},n)};e=e.split("\n");return[e.map(e=>{if(0!==e.indexOf(">>"))return 0===e.indexOf(">")?l(e):null;{var n=document.createElement("button");const[r,t]=e.slice(2).split("@");return n.textContent=i(r,t),n.onclick=()=>a(t),n}}).filter(e=>e),e.filter(e=>0!==e.indexOf(">")).join("\n")]};function s(e){var n=0;if(0!=e.length)for(i=0;i<e.length;i++)n=(n<<5)-n+(char=e.charCodeAt(i)),n&=n;return n}const d=a=>{return[...a.matchAll(/\(.*\)/gm)].map(e=>{var n,r,t,o,[e]=e;-1<e.indexOf("|")&&(n=e.slice(1,-1).split("|"),r=s(c.node+"-"+n[0]),o=n[t=c[r]??0],0===t?c[r]=1:t<n.length-1&&(c[r]+=1),a=a.replace(e,o))}),a};window.addEventListener("load",()=>{c={...e},m("start")});const p=r=>{return[...r.matchAll(/\{\{(.*)\}\}/gm)].map(e=>{var[e,n]=e,n=(e=>{e=(e=e.trim()).toLowerCase();var n,r=c.node.split("/");if(r)return r.pop(),r.push(e),n=s(r.join("/")),c[n]?([n,r]=u(r.join("/")),t(n),r):([n,r]=u(e),t(n),r)})(n);r=r.replace(e,n)}),r};let c={};const l=(e,n=!1)=>{let r=0;const t=n?"div":"p";return e.split("\n").map(e=>e.trim()).join("\n").split("\n\n").filter(e=>""!==e).map(e=>`<${t}>${(t=>{const o={quote:!0,bold:!0,italic:!0};var e=(e,n,r)=>{for(;-1<t.indexOf(e);)t=o[n]?t.replace(e,`<${r}>`):t.replace(e,`</${r}>`),o[n]=!o[n]},n=(n,r)=>t=t.split("\n").map(e=>0===e.trimStart().indexOf(n)?`<${r}>${e.replace(n,"")}</${r}>`:e).join("\n");for(n("#### ","h4"),n("### ","h3"),n("## ","h2"),n("# ","h1");-1<t.indexOf("[[");)t=r%2==0?t.replace("[[","&ldquo;"):t.replace("[[","&lsquo;"),r+=1;for(;-1<t.indexOf("]]");)--r,t=r%2==0?t.replace("]]","&rdquo;"):t.replace("]]","&rsquo;");for(e("``","quote","q"),e('"',"quote","q"),e("**","bold","b"),e("*","italic","i");-1<t.indexOf("'");)t=t.replace("'","&rsquo;");return t=t.trim()})(e)}</${t}>`).join("")};function t(e){const n=document.getElementById("btns");e.map(e=>n.appendChild(e))}function u(e){var n=s((e=e.toLowerCase())+"/"+(c[e+"-state"]??"main"));let r="";r=c[n]||(n=s(e),c[n]),r=h(r);var[e,n]=a(r);return[e,n]}function m(e){e=e.toLowerCase();var n=c[e+"-state"]??"main",r=s(e+"/"+n);let t="";c.base=e,t=c[r]?(c.node=e+"/"+n,c[r]):(n=s(e),c.node=e,c[n]),t=h(t);var[r,e]=a(t);{n=r,r=e;const o=document.getElementById("btns");document.getElementById("page").innerHTML=l(r),n.map(e=>o.appendChild(e))}}const h=n=>{const r=/\?\s*\((.*)\)\s*=>\s\{([^<>]*)\}/gm,t=e=>{var n;return-1<(e=e.trim()).indexOf("!")?(n=s(e=e.replace("!")),!c[n]):(n=s(e),c[n])};{let e=[...n.matchAll(r)];for(;0<e.length;){var o=e[0],[a,i,l]=o,o=o.index;n=n.replace(a,""),a=i,t(a)&&(n=n.slice(0,o)+l+n.slice(o,n.length)),e=[...n.matchAll(r)]}n=p(n),n=(n=d(n)).split(/\r?\n/).map(r=>{if("#"===r[0]){let e=!0,n=r.trim();-1<(n=n.replace("#","")).indexOf("!")&&(e=!1,n=n.replace("!",""));var t=s(n);return c[t]=e,""}if("$"!==r[0])return r;{let e=r.trim();t=(e=(e=e.replace("$","")).split("/")).pop(),r=(e.join("/")+"-state").toLowerCase();return c[r]=t,""}}).join("\n").trim()}return n};